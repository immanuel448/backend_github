<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cap√≠tulo 1</title>
</head>
<body style="background:#e6f0ff; text-align:center; padding-top:100px;">
  <h1>Cap√≠tulo 1</h1>
  <p>Contenido de prueba.</p>

  <a href="index.html">Volver al inicio</a> |
  <a href="cap2.html">Ir al Cap√≠tulo 2</a>

  <div id="cerrar-sesion" style="margin-top:50px; cursor:pointer; color:red;">Cerrar sesi√≥n</div>

  <!-- 
    ‚öôÔ∏è PROTECCI√ìN REAL:
    Este archivo (cap1.html) est√° protegido por el backend en Program.cs.

    En concreto, el middleware del servidor:
    ---------------------------------------------------
    app.Use(async (context, next) =>
    {
        var path = context.Request.Path.Value?.ToLower();

        // Permite libre acceso solo a acceso.html, API, im√°genes, JS y CSS
        if (path == "/" ||
            path.Contains("/api/") ||
            path.Contains("acceso.html") ||
            path.Contains(".js") ||
            path.Contains(".css") ||
            path.Contains(".png") ||
            path.Contains(".jpg") ||
            path.Contains(".webp") ||
            path.Contains(".ico"))
        {
            await next();
            return;
        }

        // Si no hay sesi√≥n activa -> redirige autom√°ticamente
        var sesion = context.Session.GetString("autenticado");
        if (sesion == "true")
        {
            // Se evita el cach√© del navegador (para que no se pueda ver al volver atr√°s)
            context.Response.Headers["Cache-Control"] = "no-store, no-cache, must-revalidate";
            context.Response.Headers["Pragma"] = "no-cache";
            context.Response.Headers["Expires"] = "0";

            await next();
        }
        else
        {
            context.Response.Redirect("/acceso.html");
        }
    });
    ---------------------------------------------------

    üîπ Por lo tanto:
    - Si el usuario no ha iniciado sesi√≥n, el backend no le entrega este HTML.
    - Si intenta entrar directo (por URL o inspecci√≥n), el servidor lo redirige al acceso.
    - Si cierra sesi√≥n y presiona ‚ÄúAtr√°s‚Äù, la p√°gina no se mostrar√° (por los headers no-cache).
  -->

<script src="/js/acceso.js"></script>

</body>
</html>
